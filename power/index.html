<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>山海Power | 望山海(See Mountain Sea）- 致力于打造好用的Java组件仓库</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="./SeeMountainSea.png">
    <meta name="description" content="迎神兽，望山海，镇苍穹。">
    
    <link rel="preload" href="/assets/css/0.styles.11fa4f0a.css" as="style"><link rel="preload" href="/assets/js/app.364d8524.js" as="script"><link rel="preload" href="/assets/js/3.9490caa6.js" as="script"><link rel="preload" href="/assets/js/1.ef43800b.js" as="script"><link rel="preload" href="/assets/js/15.1a05a2ed.js" as="script"><link rel="prefetch" href="/assets/js/10.de579db5.js"><link rel="prefetch" href="/assets/js/11.b192518e.js"><link rel="prefetch" href="/assets/js/12.7b6eeb14.js"><link rel="prefetch" href="/assets/js/13.40316c0c.js"><link rel="prefetch" href="/assets/js/14.e748ee15.js"><link rel="prefetch" href="/assets/js/16.73faf91f.js"><link rel="prefetch" href="/assets/js/17.5feab95d.js"><link rel="prefetch" href="/assets/js/4.ddb8ad91.js"><link rel="prefetch" href="/assets/js/5.bb200a59.js"><link rel="prefetch" href="/assets/js/6.d7ae1787.js"><link rel="prefetch" href="/assets/js/7.cc17a580.js"><link rel="prefetch" href="/assets/js/8.b7d18a27.js"><link rel="prefetch" href="/assets/js/9.8cde4f9f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.11fa4f0a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-5bb33761><div data-v-5bb33761><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-5bb33761 data-v-5bb33761><h3 class="title" data-v-59e6cb88>望山海(See Mountain Sea）- 致力于打造好用的Java组件仓库</h3> <p class="description" data-v-59e6cb88>迎神兽，望山海，镇苍穹。</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <span data-v-59e6cb88>2020 - </span>
        2024
      </a></span></div></div> <div class="hide" data-v-5bb33761><header class="navbar" data-v-5bb33761><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="./SeeMountainSea.png" alt="望山海(See Mountain Sea）- 致力于打造好用的Java组件仓库" class="logo"> <span class="site-name">望山海(See Mountain Sea）- 致力于打造好用的Java组件仓库</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><a href="/guard/" class="nav-link"><i class="iconfont reco-home"></i>
  山海Guard
</a></div><div class="nav-item"><a href="/power/" aria-current="page" class="nav-link router-link-exact-active router-link-active"><i class="iconfont reco-document"></i>
  山海Power
</a></div><div class="nav-item"><a href="/logs/" class="nav-link"><i class="iconfont reco-document"></i>
  山海Log
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      更多组件
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/formrules/" class="nav-link"><i class="undefined"></i>
  山海FormRule
</a></li><li class="dropdown-item"><!----> <a href="/dbdoc/" class="nav-link"><i class="undefined"></i>
  山海DBDoc
</a></li><li class="dropdown-item"><!----> <a href="/productivity/" class="nav-link"><i class="undefined"></i>
  山海生产力Doc
</a></li></ul></div></div><div class="nav-item"><a href="/zh/guide/" class="nav-link"><i class="iconfont reco-document"></i>
  关于山海
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-5bb33761></div> <aside class="sidebar" data-v-5bb33761><div class="personal-info-wrapper" data-v-1fad0c41 data-v-5bb33761><!----> <!----> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>7</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>0</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  主页
</a></div><div class="nav-item"><a href="/guard/" class="nav-link"><i class="iconfont reco-home"></i>
  山海Guard
</a></div><div class="nav-item"><a href="/power/" aria-current="page" class="nav-link router-link-exact-active router-link-active"><i class="iconfont reco-document"></i>
  山海Power
</a></div><div class="nav-item"><a href="/logs/" class="nav-link"><i class="iconfont reco-document"></i>
  山海Log
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="undefined"></i>
      更多组件
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/formrules/" class="nav-link"><i class="undefined"></i>
  山海FormRule
</a></li><li class="dropdown-item"><!----> <a href="/dbdoc/" class="nav-link"><i class="undefined"></i>
  山海DBDoc
</a></li><li class="dropdown-item"><!----> <a href="/productivity/" class="nav-link"><i class="undefined"></i>
  山海生产力Doc
</a></li></ul></div></div><div class="nav-item"><a href="/zh/guide/" class="nav-link"><i class="iconfont reco-document"></i>
  关于山海
</a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-5bb33761><h3 class="title" data-v-59e6cb88>山海Power</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><!---->
          
        <span data-v-59e6cb88>2020 - </span>
        2024
      </a></span></div></div> <div data-v-5bb33761><div data-v-5bb33761><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">山海Power</h1> <div data-v-8a445198><!----> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default"><div><p>山海Power - 基于SpringBoot的通用Web权限组件</p> <p>ShanHaiPower-based SpringBoot Web Permission components</p> <p><a href="https://github.com/SeeMountainSea/shanhai-power-spring-boot-starter/releases/latest"><img alt="GitHub release (latest by date)" src="https://img.shields.io/github/v/release/SeeMountainSea/shanhai-power-spring-boot-starter"></a> <a href="https://github.com/SeeMountainSea/shanhai-power-spring-boot-starter/issues"><img alt="GitHub closed issues" src="https://img.shields.io/github/issues/SeeMountainSea/shanhai-power-spring-boot-starter?color=009688"></a> <a href="https://github.com/topics/java"><img alt="GitHub top language" src="https://img.shields.io/github/languages/top/SeeMountainSea/shanhai-power-spring-boot-starter?color=eb8031"></a> <br> <a href="https://github.com/SeeMountainSea/shanhai-power-spring-boot-starter/find/master"><img alt="GitHub Code Size" src="https://img.shields.io/github/languages/code-size/SeeMountainSea/shanhai-power-spring-boot-starter?color=795548"></a> <a href="https://github.com/SeeMountainSea/shanhai-power-spring-boot-starter/find/master"><img alt="GitHub Code Lines" src="https://img.shields.io/tokei/lines/github/SeeMountainSea/shanhai-power-spring-boot-starter?color=37474F"></a> <a href="https://github.com/SeeMountainSea/shanhai-power-spring-boot-starter/blob/master/LICENSE"><img alt="GitHub License" src="https://img.shields.io/github/license/SeeMountainSea/shanhai-power-spring-boot-starter?color=534BAE"></a></p></div> <h2 id="_1-组件能力"><a href="#_1-组件能力" class="header-anchor">#</a> 1. 组件能力</h2> <ul><li><p>支持用户进行互斥鉴权</p></li> <li><p>基于注解模式的权限校验</p></li> <li><p>基于路由模式的权限校验</p></li> <li><p>支持前后端分离模式下独立用户鉴权和会话数据读写</p></li> <li><p>支持自定义权限集合实现和自定义路由集合实现</p></li> <li><p>支持自行扩展缓存协议实现数据持久化（组件默认提供基于原生Redis协议的持久化组件）</p></li> <li><p>集成OTP生成与校验核心模块，可以自行实现OTP绑定与校验能力</p></li></ul> <h3 id="_1-1-引入组件"><a href="#_1-1-引入组件" class="header-anchor">#</a> 1.1 引入组件</h3> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.wangshanhai.power<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>shanhai-power-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${last.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h3 id="_1-2-启用组件"><a href="#_1-2-启用组件" class="header-anchor">#</a> 1.2 启用组件</h3> <p>SpringBoot 2.x 启用方式</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableShanHaiPower</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShanhaiConfig</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span>
  
<span class="token punctuation">}</span>
</code></pre></div><p>SpringBoot 1.5.x 启用方式</p> <p>1）添加如下配置：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">shanhai</span><span class="token punctuation">:</span>
  <span class="token key atrule">power</span><span class="token punctuation">:</span>
    <span class="token key atrule">auto-regist</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> <span class="token comment">#低版本需要进行手动注册  </span>
</code></pre></div><p>2）自行完成对应组件注册，示例如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableShanHaiPower</span>
<span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token class-name">ShanhaiPowerConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@AutoConfigureAfter</span><span class="token punctuation">(</span><span class="token class-name">WebMvcConfigurationSupport</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShanhaiConfig</span> <span class="token keyword">extends</span> <span class="token class-name">WebMvcConfigurationSupport</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addInterceptors</span><span class="token punctuation">(</span><span class="token class-name">InterceptorRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        registry<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ShanhaiPowerInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">&quot;/**&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//按需启用(注解权限)</span>
        <span class="token comment">//registry.addInterceptor(new ShanhaiPowerAnnotationPermissionsInterceptor()).addPathPatterns(&quot;/**&quot;);</span>
        <span class="token comment">//按需启用(路由权限)</span>
        <span class="token comment">//registry.addInterceptor(new ShanhaiPowerRoutePermissionsInterceptor()).addPathPatterns(&quot;/**&quot;);</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>3）组件说明：</p> <table><thead><tr><th>组件</th> <th style="text-align:left;">组件名称</th> <th>组件说明</th></tr></thead> <tbody><tr><td>ShanhaiPowerInterceptor</td> <td style="text-align:left;">用户身份鉴权组件</td> <td>对用户登录的有效性进行鉴权</td></tr> <tr><td>ShanhaiPowerAnnotationPermissionsInterceptor</td> <td style="text-align:left;">用户注解权限鉴权组件</td> <td>对用户进行单一资源有效性进行鉴权</td></tr> <tr><td>ShanhaiPowerRoutePermissionsInterceptor</td> <td style="text-align:left;">用户路由权限鉴权组件</td> <td>对用户进行路由资源有效性进行鉴权</td></tr></tbody></table> <h3 id="_1-3-配置说明"><a href="#_1-3-配置说明" class="header-anchor">#</a> 1.3 配置说明</h3> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">shanhai</span><span class="token punctuation">:</span>
  <span class="token key atrule">power</span><span class="token punctuation">:</span>
    <span class="token key atrule">tokenName</span><span class="token punctuation">:</span> token <span class="token comment">#Token名称</span>
    <span class="token key atrule">tokenAlgorithm</span><span class="token punctuation">:</span> uuid <span class="token comment"># Token生成算法</span>
    <span class="token key atrule">token-prefix</span><span class="token punctuation">:</span> <span class="token string">'shanhai '</span> <span class="token comment">#Token前缀</span>
    <span class="token key atrule">exclusive-login</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#同端互斥登录 （默认为false）</span>
    <span class="token key atrule">auth-path-patterns</span><span class="token punctuation">:</span> <span class="token comment">#鉴权组件拦截范围</span>
       <span class="token punctuation">-</span> /<span class="token important">**</span>
    <span class="token key atrule">auth-exclude-path-patterns</span><span class="token punctuation">:</span>  <span class="token comment">#鉴权组件拦截白名单范围 </span>
       <span class="token punctuation">-</span> /api/xxx
</code></pre></div><h3 id="_1-4-用户会话组件"><a href="#_1-4-用户会话组件" class="header-anchor">#</a> 1.4 用户会话组件</h3> <table><thead><tr><th>API说明</th> <th>API能力</th> <th>备注</th></tr></thead> <tbody><tr><td>ShanhaiPower.login(&quot;xxx&quot;)</td> <td>通过用户标识进行登录（xxx为用户名或ID）</td> <td>1.默认渠道为Default 2.返回TokenInfo</td></tr> <tr><td>ShanhaiPower.login(&quot;xxx&quot;,&quot;PC&quot;)</td> <td>指定渠道登录</td> <td>返回TokenInfo</td></tr> <tr><td>ShanhaiPower.getCurrentUserToken()</td> <td>获取当前登录的用户信息</td> <td>返回TokenInfo</td></tr> <tr><td>ShanhaiPower.setTokenSessionData(String key,Object data)</td> <td>设置基于Token的会话级数据</td> <td></td></tr> <tr><td>ShanhaiPower.getTokenSessionData(String key)</td> <td>获取基于Token的会话级数据</td> <td></td></tr> <tr><td>ShanhaiPower.logOutByToken(String token)</td> <td>注销指定Token</td> <td></td></tr> <tr><td>ShanhaiPower.logOut(Object userFlag)</td> <td>注销指定用户会话</td> <td></td></tr> <tr><td>ShanhaiPower.logOut(Object userFlag,String channel)</td> <td>注销指定用户指定渠道会话</td> <td></td></tr></tbody></table> <p>忽略用户会话校验</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequestNotNeedAuth</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">TokenInfo</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token class-name">ShanhaiPower</span><span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token string">&quot;xxx&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_1-5-注解权限组件"><a href="#_1-5-注解权限组件" class="header-anchor">#</a> 1.5 注解权限组件</h3> <p>注解权限组件配置参数如下：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">shanhai</span><span class="token punctuation">:</span>
  <span class="token key atrule">power</span><span class="token punctuation">:</span>
    <span class="token key atrule">annotation-permissions-enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#启用路由权限组件</span>
    <span class="token key atrule">permission-path-patterns</span><span class="token punctuation">:</span> <span class="token comment">#权限组件拦截范围 （路由和注解权限共享）</span>
      <span class="token punctuation">-</span> /<span class="token important">**</span>
    <span class="token key atrule">permission-exclude-path-patterns</span><span class="token punctuation">:</span> <span class="token comment">#权限组件拦截白名单范围 （路由和注解权限共享）</span>
      <span class="token punctuation">-</span> /api/xxx
</code></pre></div><p>注解权限组件示例如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequiresPermissions</span><span class="token punctuation">(</span><span class="token string">&quot;user:details&quot;</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/queryUserInfo&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">TokenInfo</span> <span class="token function">queryUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">ShanhaiPower</span><span class="token punctuation">.</span><span class="token function">getCurrentUserToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在对应的方法上添加@RequiresPermissions，并且写入权限编码。</p> <p>实现PermissionService，动态为当前用户追加权限编码。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PermissionServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">PermissionService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">queryAllPermission</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> allPermission<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        allPermission<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;user:details&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        allPermission<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;user:route&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> allPermission<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="_1-6-路由权限组件"><a href="#_1-6-路由权限组件" class="header-anchor">#</a> 1.6 路由权限组件</h3> <p>路由权限组件配置参数如下：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">shanhai</span><span class="token punctuation">:</span>
  <span class="token key atrule">power</span><span class="token punctuation">:</span>
    <span class="token key atrule">route-permission-enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#启用路由权限组件</span>
    <span class="token key atrule">route-permissions</span><span class="token punctuation">:</span>  <span class="token comment">#路由权限配置（可以配置多个）</span>
      <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">'/route/**'</span>
        <span class="token key atrule">permission</span><span class="token punctuation">:</span> <span class="token string">'user:route'</span>
    <span class="token key atrule">permission-path-patterns</span><span class="token punctuation">:</span> <span class="token comment">#权限组件拦截范围 （路由和注解权限共享）</span>
      <span class="token punctuation">-</span> /<span class="token important">**</span>
    <span class="token key atrule">permission-exclude-path-patterns</span><span class="token punctuation">:</span> <span class="token comment">#权限组件拦截白名单范围 （路由和注解权限共享）</span>
      <span class="token punctuation">-</span> /api/xxx
</code></pre></div><p>对于一些简单的系统，可能只想基于路由做一些简单的控制，此时可以考虑使用路由组件。</p> <p>需要注意的是，路由组件支持通过配置文件进行配置</p> <p>也支持通过实现PermissionService中的loadRoutePermissionConfig方法来进行。<strong>自定义加载的方式优先级高于配置文件的方式</strong>。</p> <p>路由权限组件同样需要实现PermissionService，动态为当前用户追加权限编码。</p> <p>实现方式参考第1.5章节。</p> <h3 id="_1-7-用户安全锁定组件"><a href="#_1-7-用户安全锁定组件" class="header-anchor">#</a> 1.7 用户安全锁定组件</h3> <p>在配置文件中新增如下配置参数：</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">shanhai</span><span class="token punctuation">:</span>
  <span class="token key atrule">power</span><span class="token punctuation">:</span>
    <span class="token key atrule">lockThreshold</span><span class="token punctuation">:</span> <span class="token number">5</span> <span class="token comment">#锁定阈值（默认:5）</span>
    <span class="token key atrule">lockThresholdExpire</span><span class="token punctuation">:</span> <span class="token number">3600</span> <span class="token comment">#锁定阈值累计有效期（单位:s,默认:1小时）</span>
    <span class="token key atrule">lockExpire</span><span class="token punctuation">:</span> <span class="token number">1800</span> <span class="token comment"># 锁定时长（单位:s,默认:30分钟）</span>
</code></pre></div><p>安全锁定组件相关方法如下：</p> <table><thead><tr><th>API说明</th> <th>API能力</th> <th>备注</th></tr></thead> <tbody><tr><td>ShanhaiPower.loginLock(Object userFlag)</td> <td>登录锁定判断</td> <td>指定用户是否已被锁定，返回Boolean类型</td></tr> <tr><td>ShanhaiPower.loginLock(Object userFlag,String channel)</td> <td>登录锁定判断</td> <td>指定用户&amp;指定登录渠道，是否已被锁定，返回Boolean类型</td></tr> <tr><td>ShanhaiPower.loginFailure(Object userFlag)</td> <td>登录失败调用</td> <td>当用户登录失败时，手动调用触发阈值累计方法</td></tr> <tr><td>ShanhaiPower.loginFailure(Object userFlag,String channel)</td> <td>登录失败调用</td> <td>当用户指定渠道登录失败时，手动调用触发阈值累计方法</td></tr></tbody></table> <h3 id="_1-8-统一异常管理"><a href="#_1-8-统一异常管理" class="header-anchor">#</a> 1.8 统一异常管理</h3> <table><thead><tr><th>组件异常类</th> <th>说明</th></tr></thead> <tbody><tr><td>ShanHaiNotLoginException</td> <td>用户会话鉴权相关异常</td></tr> <tr><td>ShanHaiNotPermissionException</td> <td>用户权限相关异常</td></tr> <tr><td>ShanHaiPowerException</td> <td>异常基类</td></tr></tbody></table> <p>可以使用SpringBoot的统一异常管理进行控制</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">ShanHaiPowerException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">shanHaiPowerErrorHandler</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> resp<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    resp<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ShanHaiPowerException</span><span class="token punctuation">)</span>e<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    resp<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">HttpHeaders</span> headers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">MediaType</span> mediaType <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaType</span><span class="token punctuation">(</span><span class="token string">&quot;application&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;json&quot;</span><span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span><span class="token constant">UTF_8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    headers<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span>mediaType<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">ResponseEntity</span><span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span><span class="token constant">INTERNAL_SERVER_ERROR</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span>headers<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_1-9-扩展-会话持久化"><a href="#_1-9-扩展-会话持久化" class="header-anchor">#</a> 1.9 扩展-会话持久化</h3> <p>可以通过实现PowerStoreService，来实现自定义的会话持久化。</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 会话存储服务
 * @author Shmily
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PowerStoreService</span> <span class="token punctuation">{</span>

    <span class="token comment">/**
     * 设置缓存失效时间
     * @param key
     * @param time (单位s)
     * @return
     */</span>
    <span class="token class-name">Long</span> <span class="token function">expire</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">int</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 判断key是否存在
     * @param key
     * @return
     */</span>
    <span class="token keyword">boolean</span> <span class="token function">exists</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * 查询key过期时间
     * @param key
     * @return
     */</span>
    <span class="token keyword">long</span> <span class="token function">ttl</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * 删除key
     * @param key
     * @return
     */</span>
    <span class="token keyword">void</span> <span class="token function">del</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * 读取key对应的值
     * @param key
     * @return
     */</span>
    <span class="token class-name">Object</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * 设置key:value
     * @param key
     * @return
     */</span>
    <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * 设置key和过期时间
     * @param key
     * @return
     */</span>
    <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="_1-10-扩展-token生成规则"><a href="#_1-10-扩展-token生成规则" class="header-anchor">#</a> 1.10 扩展-Token生成规则</h3> <p>组件默认集成了uuid和sha512方式的Token生成规则，可以通过配置参数来实现。</p> <p>同时，也支持自己实现TokenGenerateService，来实现自定义的Token生成规则。</p> <p>如果需要传入额外参数生成Token，需要在登录的时候使用如下方法登录：</p> <div class="language- extra-class"><pre class="language-text"><code>ShanhaiPower.login(Object userFlag,String channel, Map&lt;String, Object&gt; extParams)
</code></pre></div><h2 id="_2-otp双因素认证扩展-mfa"><a href="#_2-otp双因素认证扩展-mfa" class="header-anchor">#</a> 2.OTP双因素认证扩展（MFA）</h2> <p>山海power集成了HOTP和TOTP，使用时需要引入如下依赖：</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>commons-codec.version</span><span class="token punctuation">&gt;</span></span>1.15<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>commons-codec.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>zxing-core.version</span><span class="token punctuation">&gt;</span></span>3.3.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>zxing-core.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>zxing-javase.version</span><span class="token punctuation">&gt;</span></span>3.3.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>zxing-javase.version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-codec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-codec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${commons-codec.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.google.zxing<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${zxing-core.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.google.zxing<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>javase<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${zxing-javase.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><blockquote><p>用户和OTP集成方式因人而异，因此需要自行绑定用户身份和OTP密钥并做好存储。</p> <p>推荐使用TOTP作为双因素认证使用，HOTP的counter容易被爆破，从而降低安全性。</p></blockquote> <h3 id="_2-1-hotp示例"><a href="#_2-1-hotp示例" class="header-anchor">#</a> 2.1 HOTP示例</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">String</span> qrCodeContent<span class="token operator">=</span>hotp<span class="token punctuation">.</span><span class="token function">getURI</span><span class="token punctuation">(</span><span class="token number">1111</span><span class="token punctuation">,</span><span class="token string">&quot;testuser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//自动生成密钥</span>
<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> secret <span class="token operator">=</span>  <span class="token class-name">SecretGenerator</span><span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//偏移值，可以自行定义</span>
<span class="token keyword">long</span> counter<span class="token operator">=</span><span class="token number">7891</span><span class="token punctuation">;</span> 
<span class="token class-name">HOTPGenerator</span> hotp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HOTPGenerator<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span>secret<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withPasswordLength</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">withAlgorithm</span><span class="token punctuation">(</span><span class="token class-name">HMACAlgorithm</span><span class="token punctuation">.</span><span class="token constant">SHA256</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//生成OTP协议（可以用于生成二维码）   </span>
<span class="token class-name">String</span> qrCodeContent<span class="token operator">=</span>hotp<span class="token punctuation">.</span><span class="token function">getURI</span><span class="token punctuation">(</span>counter<span class="token punctuation">,</span><span class="token string">&quot;testuser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//校验动态码是否正确</span>
hotp<span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-2-totp示例"><a href="#_2-2-totp示例" class="header-anchor">#</a> 2.2 TOTP示例</h3> <div class="language- extra-class"><pre class="language-text"><code>// Generate a secret (or use your own secret)
byte[] secret = SecretGenerator.generate();
TOTPGenerator totp = new TOTPGenerator.Builder(secret)
        .withHOTPGenerator(builder -&gt; {
            builder.withPasswordLength(6);
            builder.withAlgorithm(HMACAlgorithm.SHA256); // SHA256 and SHA512 are also supported
        })
        .withPeriod(Duration.ofSeconds(30))
        .build();
//生成OTP协议（可以用于生成二维码）        
String qrCodeContent=totp.getURI(&quot;platName&quot;,&quot;zhangsan&quot;).toString();
//校验动态码是否正确
totp.verify(&quot;331197&quot;)
</code></pre></div><h3 id="_2-3-生成otp绑定二维码"><a href="#_2-3-生成otp绑定二维码" class="header-anchor">#</a> 2.3 生成OTP绑定二维码</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">int</span> width <span class="token operator">=</span> <span class="token number">800</span><span class="token punctuation">;</span><span class="token comment">// 二维码宽度</span>
<span class="token keyword">int</span> height <span class="token operator">=</span> <span class="token number">800</span><span class="token punctuation">;</span><span class="token comment">// 二维码高度</span>
<span class="token keyword">int</span> margin <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">// 二维码边距</span>

<span class="token class-name">String</span> logoPath <span class="token operator">=</span> <span class="token string">&quot;d:/xxx.jpg&quot;</span><span class="token punctuation">;</span><span class="token comment">// LOGO图片路径</span>
<span class="token keyword">int</span> logoSizeMultiple <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token comment">// 二维码与LOGO的大小比例</span>

<span class="token class-name">String</span> filePath <span class="token operator">=</span> <span class="token string">&quot;d:/otp.jpg&quot;</span><span class="token punctuation">;</span><span class="token comment">// 指定生成图片文件的保存路径</span>
<span class="token class-name">String</span> fileName <span class="token operator">=</span> <span class="token string">&quot;totp&quot;</span><span class="token punctuation">;</span><span class="token comment">// 生成的图片文件名</span>
<span class="token class-name">String</span> formatName <span class="token operator">=</span> <span class="token string">&quot;jpg&quot;</span><span class="token punctuation">;</span><span class="token comment">// 生成的图片格式，可自定义</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// 生成二维码(qrCodeContent即为2.1或2.2中生成的内容)</span>
    <span class="token class-name">BufferedImage</span> qrcode <span class="token operator">=</span> <span class="token class-name">QRCodeUtils</span><span class="token punctuation">.</span><span class="token function">createQRCode</span><span class="token punctuation">(</span>qrCodeContent<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span>margin<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 添加LOGO</span>
    <span class="token comment">//           qrcode = QRCodeUtils.createQRCodeWithLogo(qrcode, width, height, logoPath,logoSizeMultiple);</span>
    <span class="token comment">// 导出到指定路径</span>
    <span class="token keyword">boolean</span> result <span class="token operator">=</span> <span class="token class-name">QRCodeUtils</span><span class="token punctuation">.</span><span class="token function">generateQRCodeToPath</span><span class="token punctuation">(</span>qrcode<span class="token punctuation">,</span> filePath<span class="token punctuation">,</span> fileName<span class="token punctuation">,</span> formatName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;执行结果&quot;</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>可以使用支持OTP协议的客户端进行扫码，如2FAS</p></blockquote></div></section> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-ac050c62><li class="level-2" data-v-ac050c62><a href="/power/#_1-组件能力" class="sidebar-link reco-side-_1-组件能力" data-v-ac050c62>1. 组件能力</a></li><li class="level-3" data-v-ac050c62><a href="/power/#_1-1-引入组件" class="sidebar-link reco-side-_1-1-引入组件" data-v-ac050c62>1.1 引入组件</a></li><li class="level-3" data-v-ac050c62><a href="/power/#_1-2-启用组件" class="sidebar-link reco-side-_1-2-启用组件" data-v-ac050c62>1.2 启用组件</a></li><li class="level-3" data-v-ac050c62><a href="/power/#_1-3-配置说明" class="sidebar-link reco-side-_1-3-配置说明" data-v-ac050c62>1.3 配置说明</a></li><li class="level-3" data-v-ac050c62><a href="/power/#_1-4-用户会话组件" class="sidebar-link reco-side-_1-4-用户会话组件" data-v-ac050c62>1.4 用户会话组件</a></li><li class="level-3" data-v-ac050c62><a href="/power/#_1-5-注解权限组件" class="sidebar-link reco-side-_1-5-注解权限组件" data-v-ac050c62>1.5 注解权限组件</a></li><li class="level-3" data-v-ac050c62><a href="/power/#_1-6-路由权限组件" class="sidebar-link reco-side-_1-6-路由权限组件" data-v-ac050c62>1.6 路由权限组件</a></li><li class="level-3" data-v-ac050c62><a href="/power/#_1-7-用户安全锁定组件" class="sidebar-link reco-side-_1-7-用户安全锁定组件" data-v-ac050c62>1.7 用户安全锁定组件</a></li><li class="level-3" data-v-ac050c62><a href="/power/#_1-8-统一异常管理" class="sidebar-link reco-side-_1-8-统一异常管理" data-v-ac050c62>1.8 统一异常管理</a></li><li class="level-3" data-v-ac050c62><a href="/power/#_1-9-扩展-会话持久化" class="sidebar-link reco-side-_1-9-扩展-会话持久化" data-v-ac050c62>1.9 扩展-会话持久化</a></li><li class="level-3" data-v-ac050c62><a href="/power/#_1-10-扩展-token生成规则" class="sidebar-link reco-side-_1-10-扩展-token生成规则" data-v-ac050c62>1.10 扩展-Token生成规则</a></li><li class="level-2" data-v-ac050c62><a href="/power/#_2-otp双因素认证扩展-mfa" class="sidebar-link reco-side-_2-otp双因素认证扩展-mfa" data-v-ac050c62>2.OTP双因素认证扩展（MFA）</a></li><li class="level-3" data-v-ac050c62><a href="/power/#_2-1-hotp示例" class="sidebar-link reco-side-_2-1-hotp示例" data-v-ac050c62>2.1 HOTP示例</a></li><li class="level-3" data-v-ac050c62><a href="/power/#_2-2-totp示例" class="sidebar-link reco-side-_2-2-totp示例" data-v-ac050c62>2.2 TOTP示例</a></li><li class="level-3" data-v-ac050c62><a href="/power/#_2-3-生成otp绑定二维码" class="sidebar-link reco-side-_2-3-生成otp绑定二维码" data-v-ac050c62>2.3 生成OTP绑定二维码</a></li></ul></main></div> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.364d8524.js" defer></script><script src="/assets/js/3.9490caa6.js" defer></script><script src="/assets/js/1.ef43800b.js" defer></script><script src="/assets/js/15.1a05a2ed.js" defer></script>
  </body>
</html>
